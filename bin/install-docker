#!/usr/bin/env sh


env_path=config/app.env
yml_path=config/app.yml

docker_compose_base_path=deploy/docker-compose.base.yml
docker_compose_mass_labeling_prod_path=deploy/docker-compose.mass-labeling.prod.yml
docker_compose_mongo_path=deploy/docker-compose.mongo.yml
docker_compose_path=docker-compose.yml

default_port=80


read -p "Enter server port ($default_port): " port
read -p "Enter cookie secret: " cookie_secret
echo ""

if [ -z "$port" ]; then
  port="$default_port"
fi


echo "Save $docker_compose_path"
cp "$docker_compose_base_path" "$docker_compose_path"
cat "$docker_compose_mass_labeling_prod_path" | sed -e "s/\__PORT__/$port/" >> "$docker_compose_path"
cat "$docker_compose_mongo_path" >> "$docker_compose_path"


echo "Save $env_path"
: > "$env_path"
echo "COOKIE_SECRET=$cookie_secret" >> "$env_path"


echo "Save $yml_path"
: > "$yml_path"
echo "{}" >> "$yml_path"
